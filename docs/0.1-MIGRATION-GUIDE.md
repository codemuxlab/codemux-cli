# Migration Guide: 0.0.x to 0.1.x

## Overview

CodeMux 0.1 introduces a server-client architecture that changes how sessions are managed while maintaining backward compatibility for most use cases.

## Key Changes

### Command Changes
| 0.0.x | 0.1.x | Notes |
|-------|--------|--------|
| `codemux daemon` | `codemux server` | Renamed for clarity |
| `codemux run claude` | `codemux run claude` | Same command, new behavior |
| N/A | `codemux attach <session>` | New: attach to existing session |
| N/A | `codemux kill-session <session>` | New: terminate specific session |

### Behavior Changes

#### Session Persistence
- **0.0.x**: Sessions terminated when client disconnected
- **0.1.x**: Sessions continue running in background, can be reattached

#### Web Server
- **0.0.x**: Each `codemux run` started its own web server
- **0.1.x**: Single web server in server handles all sessions

#### Resource Usage
- **0.0.x**: Multiple processes for multiple sessions
- **0.1.x**: Single server process manages all sessions

## Migration Steps

### 1. Stop Existing Daemon
```bash
# If you have 0.0.x daemon running
codemux stop

# Or manually kill the process
pkill -f "codemux daemon"
```

### 2. Update Binary
```bash
# Via homebrew
brew upgrade codemux

# Via npm  
npm update -g codemux

# Via cargo
cargo install --git https://github.com/codemuxlab/codemux-cli
```

### 3. Configuration Migration
Your existing config will be automatically migrated:

#### Old config (`~/.config/codemux/config.toml`)
```toml
[daemon]
port = 8765
data_dir = "~/.local/share/codemux"
pid_file = "~/.local/share/codemux/daemon.pid"
```

#### New config (auto-migrated)
```toml
[server]
port = 8765
data_dir = "~/.local/share/codemux"  
pid_file = "~/.local/share/codemux/server.pid"
```

### 4. Start Using New Commands
```bash
# Start server (optional - auto-starts when needed)
codemux server

# Create new session (same as before)
codemux run claude

# List running sessions (new)
codemux list

# Attach to existing session (new)
codemux attach <session-id>
```

## Workflow Changes

### Before (0.0.x)
```bash
# Each command created isolated session
codemux run claude          # Session 1, web server on port 8765
codemux run claude -p 8766  # Session 2, web server on port 8766  
codemux run gemini -p 8767  # Session 3, web server on port 8767
```

### After (0.1.x)  
```bash
# Server manages all sessions, single web interface
codemux run claude    # Creates session, accessible at http://localhost:8765
codemux run gemini    # Creates another session, same web interface
codemux list          # Shows both sessions
```

## New Capabilities

### Session Management
```bash
# Create named session
codemux new-session -s "my-project" claude

# List all sessions
codemux list
# Output:
# Session ID: abc123  Agent: claude   Status: running
# Session ID: def456  Agent: gemini   Status: running

# Attach to specific session
codemux attach abc123

# Kill specific session
codemux kill-session def456
```

### Multi-client Access
```bash
# Terminal 1
codemux run claude
# Creates session abc123

# Terminal 2  
codemux attach abc123
# Both terminals now share the same session
```

### Web Interface
- Single URL (`http://localhost:8765`) shows all sessions
- Session switching in web UI
- All sessions accessible from mobile/tablet

## Troubleshooting

### Server Won't Start
```bash
# Check if port is in use
lsof -i :8765

# Check server logs
codemux server status

# Force clean start
rm ~/.local/share/codemux/server.pid
codemux server
```

### Sessions Not Persisting
- Sessions now persist by default
- Check server is running: `codemux server status`
- Old sessions from 0.0.x are not recovered

### Multiple Web Servers
If you see multiple web servers:
- Stop all codemux processes: `pkill -f codemux`
- Start fresh: `codemux server`
- Create new session: `codemux run claude`

### Configuration Issues
```bash
# Reset to default config
mv ~/.config/codemux/config.toml ~/.config/codemux/config.toml.backup
codemux server  # Will create new default config
```

## Compatibility

### What Still Works
- All existing `codemux run` commands
- Same web interface URLs and features
- All AI agent integrations (Claude, Gemini, Aider, etc.)
- Project management
- Session continuity with `--continue` flag

### What's Different  
- Sessions persist after client disconnection
- Single web server instead of multiple
- New session management commands available
- Better resource efficiency

## Performance Impact

### Memory Usage
- **Reduced**: Single server process instead of multiple
- **Optimized**: Shared web server resources
- **Efficient**: Better session management

### Startup Time
- **Faster**: Server stays running, new sessions start quickly
- **Auto-start**: Server starts automatically when needed
- **Ready**: Web interface immediately available

## Rollback (if needed)

If you need to rollback to 0.0.x:

```bash
# Stop 0.1.x server
codemux server stop

# Install 0.0.x version
# (specific installation steps depend on your package manager)

# Remove 0.1.x config
rm ~/.config/codemux/config.toml
```

Note: Sessions created in 0.1.x will not be available in 0.0.x.

## Support

If you encounter issues during migration:

1. Check the troubleshooting section above
2. Review server logs: `codemux server status`
3. File an issue: https://github.com/codemuxlab/codemux-cli/issues
4. Include your config and any error messages